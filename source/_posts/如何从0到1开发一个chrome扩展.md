---
title: 如何从0到1开发一个chrome扩展
date: 2022-05-10
headimg: https://images.unsplash.com/photo-1682027888746-25b1af7bd47f?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=900&q=80
---

实战一个实用性的chrome扩展,倍速播放视频

<!-- more -->

<section id="nice" data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px; padding: 0 10px; word-spacing: 0px; word-break: break-word; word-wrap: break-word; text-align: left; line-height: 1.25; color: #2b2b2b; font-family: Optima-Regular, Optima, PingFangTC-Light, PingFangSC-light, PingFangTC-light; letter-spacing: 2px; background-image: linear-gradient(90deg, rgba(50, 0, 0, 0.04) 3%, rgba(0, 0, 0, 0) 3%), linear-gradient(360deg, rgba(50, 0, 0, 0.04) 3%, rgba(0, 0, 0, 0) 3%); background-size: 20px 20px; background-position: center center;"><h1 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 25px;"><span class="prefix" style="font-weight: bold; color: #40B8FA; display: none;"></span><span class="content" style="display: inline-block; font-weight: bold; color: #40B8FA;">如何从0到1实现一个chrome扩展</span><span class="suffix" style="display: inline-block; font-weight: bold; color: #40B8FA;"></span></h1>
<h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; display: block; border-bottom: 4px solid #40B8FA;"><span class="prefix" style="display: flex; width: 20px; height: 20px; background-size: 20px 20px; background-image: url(https://my-wechat.mdnice.com/fullstack-1.png); margin-bottom: -22px;"></span><span class="content" style="display: flex; color: #40B8FA; font-size: 20px; margin-left: 25px;">要实现的功能</span><span class="suffix" style="display: flex; box-sizing: border-box; width: 200px; height: 10px; border-top-left-radius: 20px; background: RGBA(64, 184, 250, .5); color: rgb(255, 255, 255); font-size: 16px; letter-spacing: 0.544px; justify-content: flex-end; float: right; margin-top: -10px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></h2>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">向某网盘页面及视频上注入倍速播放的 dom 元素，支持自定义倍速，至于原理，实际上就是调用页面上的一个方法，这个视频看的很清楚了
<a href="https://www.bilibili.com/video/BV1sT4y1g7J4?p=1&amp;share_medium=iphone&amp;share_plat=ios&amp;share_source=COPY&amp;share_tag=s_i&amp;timestamp=1593432582&amp;unique_k=8K40Y4" style="text-decoration: none; word-wrap: break-word; color: #40B8FA; font-weight: normal; border-bottom: 1px solid #3BAAFA;">哔哩哔哩</a></p>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">众所周知，非会员下的某盘不能倍速播放视频，然后就在想是不是写个chrome插件会比较方便一点</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/369b416c2d3349eeabc02c69a6a79af2~tplv-k3u1fbpfcp-watermark.image" alt style="max-width: 100%; border-radius: 6px; display: block; margin: 20px auto; object-fit: contain; box-shadow: 2px 4px 7px #999;"></figure>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">本代码可以在<a href="https://github.com/lovelyJason/baidu_player_speed.git" style="text-decoration: none; word-wrap: break-word; color: #40B8FA; font-weight: normal; border-bottom: 1px solid #3BAAFA;">https://github.com/lovelyJason/baidu_player_speed.git</a>找到</p>
<h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; display: block; border-bottom: 4px solid #40B8FA;"><span class="prefix" style="display: flex; width: 20px; height: 20px; background-size: 20px 20px; background-image: url(https://my-wechat.mdnice.com/fullstack-1.png); margin-bottom: -22px;"></span><span class="content" style="display: flex; color: #40B8FA; font-size: 20px; margin-left: 25px;">基本知识/组件</span><span class="suffix" style="display: flex; box-sizing: border-box; width: 200px; height: 10px; border-top-left-radius: 20px; background: RGBA(64, 184, 250, .5); color: rgb(255, 255, 255); font-size: 16px; letter-spacing: 0.544px; justify-content: flex-end; float: right; margin-top: -10px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></h2>
<h3 data-tool="mdnice编辑器" style="padding: 0px; color: black; font-size: 17px; font-weight: bold; text-align: center; position: relative; margin-top: 20px; margin-bottom: 20px;"><span class="prefix" style="display: none;"></span><span class="content" style="border-bottom: 2px solid RGBA(79, 177, 249, .65); color: #2b2b2b; padding-bottom: 2px;"><span style="width: 30px; height: 30px; display: block; background-image: url(https://my-wechat.mdnice.com/fullstack-2.png); background-position: center; background-size: 30px; margin: auto; opacity: 1; background-repeat: no-repeat; margin-bottom: -8px;"></span>manifest.json</span><span class="suffix" style="display: none;"></span></h3>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;">{
<span/>  <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"name"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">""</span>,
<span/>  <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"version"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"1.0"</span>,
<span/>  <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"description"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">""</span>,
<span/>  <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"permissions"</span>: [<span class="hljs-string" style="color: #98c379; line-height: 26px;">"activeTab"</span>, <span class="hljs-string" style="color: #98c379; line-height: 26px;">"declarativeContent"</span>, <span class="hljs-string" style="color: #98c379; line-height: 26px;">"storage"</span>],
<span/>  <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"background"</span>: {
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"scripts"</span>: [<span class="hljs-string" style="color: #98c379; line-height: 26px;">"background.js"</span>], <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 注册background</span>
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"persistent"</span>: <span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">false</span>
<span/>  },
<span/>  <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"page_action"</span>: {
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"default_popup"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"popup.html"</span>,
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"default_icon"</span>: {         <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 插件栏上的icon图标</span>
<span/>      <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"16"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"images/get_started16.png"</span>,
<span/>      <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"32"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"images/get_started32.png"</span>,
<span/>      <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"48"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"images/get_started48.png"</span>,
<span/>      <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"128"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"images/get_started128.png"</span>
<span/>    }
<span/>  },
<span/>  <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"icons"</span>: {    <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 扩展管理页的插件图标</span>
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"16"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"images/get_started16.png"</span>,
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"32"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"images/get_started32.png"</span>,
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"48"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"images/get_started48.png"</span>,
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"128"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"images/get_started128.png"</span>
<span/>  },
<span/>  <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"options_page"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"options.html"</span>,
<span/>  <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"manifest_version"</span>: <span class="hljs-number" style="color: #d19a66; line-height: 26px;">2</span> <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 必须配置且为2.0</span>
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">manifest.json是必须的描述文件,用于配置chrome扩展,包括图标,行为等</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; text-size-adjust: 100%; line-height: 1.55em; font-weight: 400; border-radius: 6px; color: #595959; font-style: normal; text-align: left; box-sizing: inherit; border-left: none; border: 1px solid RGBA(64, 184, 250, .4); background: RGBA(64, 184, 250, .1);"><span style="color: RGBA(64, 184, 250, .5); font-size: 34px; line-height: 1; font-weight: 700;">❝</span>
<p style="padding-top: 8px; padding-bottom: 8px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px; margin: 0px; line-height: 26px; color: #595959;">chrome扩展的组件,或者说展示形式,主要有以下几种</p>
<span style="float: right; color: RGBA(64, 184, 250, .5);">❞</span></blockquote>
<h3 data-tool="mdnice编辑器" style="padding: 0px; color: black; font-size: 17px; font-weight: bold; text-align: center; position: relative; margin-top: 20px; margin-bottom: 20px;"><span class="prefix" style="display: none;"></span><span class="content" style="border-bottom: 2px solid RGBA(79, 177, 249, .65); color: #2b2b2b; padding-bottom: 2px;"><span style="width: 30px; height: 30px; display: block; background-image: url(https://my-wechat.mdnice.com/fullstack-2.png); background-position: center; background-size: 30px; margin: auto; opacity: 1; background-repeat: no-repeat; margin-bottom: -8px;"></span>background &amp; event page</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">后台脚本是扩展的事件处理程序;它包含对扩展很重要的浏览器事件的监听器。它处于休眠状态，直到触发一个事件，然后执行指示的逻辑。有效的后台脚本只在需要时加载，在空闲时卸载。
区别在于manifest.json中<code style="font-size: 14px; word-wrap: break-word; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #3594F7; background: RGBA(59, 170, 250, .1); padding: 0 2px; border-radius: 2px; height: 21px; line-height: 22px;">persistent</code>属性值的不同</p>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">没有可见页面,只是一个执行后台脚本的一个页面</p>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;"><strong style="color: #3594F7; font-weight: bold;"><span>「</span>更新 background 脚本函数<span>」</span></strong></p>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">如果使用 extension.getBackgroundPage 从后台页面调用函数，请更新为 runtime.getBackgroundPage。 较新的方法会在返回非持久脚本之前将其激活。</p>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">如果后台脚本处于不活动状态(非持久脚本的默认状态)，此方法将不起作用。较新的方法包括一个回调函数，以确保已加载后台脚本。
如 popup 中调用</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;">chrome.extension.getBackgroundPage().backgroundFunction(); <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// not work</span>
<span/></code></pre>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;">chrome.runtime.getBackgroundPage(<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span> (<span class="hljs-params" style="line-height: 26px;">backgroundPage</span>) </span>{
<span/>  backgroundPage.backgroundFunction();
<span/>});
<span/></code></pre>
<h3 data-tool="mdnice编辑器" style="padding: 0px; color: black; font-size: 17px; font-weight: bold; text-align: center; position: relative; margin-top: 20px; margin-bottom: 20px;"><span class="prefix" style="display: none;"></span><span class="content" style="border-bottom: 2px solid RGBA(79, 177, 249, .65); color: #2b2b2b; padding-bottom: 2px;"><span style="width: 30px; height: 30px; display: block; background-image: url(https://my-wechat.mdnice.com/fullstack-2.png); background-position: center; background-size: 30px; margin: auto; opacity: 1; background-repeat: no-repeat; margin-bottom: -8px;"></span>content</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">对 web 页面进行读写的扩展使用内容脚本。内容脚本包含在已加载到浏览器的页面上下文中执行的 JavaScript。内容脚本读取和修改浏览器访问的 web 页面的 DOM.可以把他理解为就是你写了一段dom,并且包含这段dom的脚本,注入到了原始页面中</p>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">内容脚本可以通过交换消息和使用存储 API 存储值与父扩展进行通信。</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; font-size: 15px; color: #595959; list-style-type: circle;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;">content-scripts 和原始页面共享 dom 但是不共享 js，如果要访问 js 如变量等，只能通过后文的 <code style="font-size: 14px; word-wrap: break-word; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #3594F7; background: RGBA(59, 170, 250, .1); padding: 0 2px; border-radius: 2px; height: 21px; line-height: 22px;">injected js</code> 实现</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;">访问 chrome 有限 api，extension,i18n, runtime, storage。如果调用其他 api，可以与 background 通信，通过 background 调用</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;">注入脚本有两种方式，编程式和声明式
<ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; font-size: 15px; color: #595959; list-style-type: square;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;">编程式：要在 manifest.json 中提供 permission 权限，设置为'activeTab'</section></li></ul>
</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;">  <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// background.js</span>
<span/>  chrome.runtime.onMessage.addListener(
<span/>  <span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span>(<span class="hljs-params" style="line-height: 26px;">string message, callback</span>) </span>{
<span/>    <span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">if</span> (message == <span class="hljs-string" style="color: #98c379; line-height: 26px;">"changeColor"</span>){
<span/>      chrome.tabs.executeScript({
<span/>        <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">code</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">'document.body.style.backgroundColor="orange"'</span>
<span/>      });
<span/>    }
<span/>  });
<span/>  <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// popup.js</span>
<span/>  chrome.runtime.sendMessage(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"changeColor"</span>, <span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span>(<span class="hljs-params" style="line-height: 26px;">response</span>) </span>{
<span/>    <span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">console</span>.log(response.farewell);
<span/>  });
<span/></code></pre>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; font-size: 15px; color: #595959; list-style-type: circle;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;">声明式注入的脚本在清单的“content_scripts”字段下面注册。它们可以包含 JavaScript 文件、CSS 文件，或者两者都包含。所有自动运行的内容脚本都必须指定匹配模式。
run_at 控制注入时机,默认 document_idle
content-script 只能获取到原始页面 dom，不能获取到 js</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;">  <span class="hljs-string" style="color: #98c379; line-height: 26px;">"content_scripts"</span>: [
<span/>  {
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"matches"</span>: [<span class="hljs-string" style="color: #98c379; line-height: 26px;">"http://*.nytimes.com/*"</span>],     <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 匹配到页面时才生成插件脚本</span>
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"css"</span>: [<span class="hljs-string" style="color: #98c379; line-height: 26px;">"myStyles.css"</span>],
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"js"</span>: [<span class="hljs-string" style="color: #98c379; line-height: 26px;">"contentScript.js"</span>],
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"run_at"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"document_start"</span>
<span/>  }
<span/>],
<span/></code></pre>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">另外还有popup页(点击插件图标的弹窗页),options页(点击扩展的详情之后的页面)就不做过多介绍了,用法都差不多,可以参考github上的项目</p>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">比如popup,先在manifest.json中配置,然后popup.html中可以script标签引入自己项目中的脚本,就能生成一个弹窗页了</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-string" style="color: #98c379; line-height: 26px;">"page_action"</span>: {
<span/>  <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"default_popup"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"popup.html"</span>
<span/>},
<span/></code></pre>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; text-size-adjust: 100%; line-height: 1.55em; font-weight: 400; border-radius: 6px; color: #595959; font-style: normal; text-align: left; box-sizing: inherit; border-left: none; border: 1px solid RGBA(64, 184, 250, .4); background: RGBA(64, 184, 250, .1);"><span style="color: RGBA(64, 184, 250, .5); font-size: 34px; line-height: 1; font-weight: 700;">❝</span>
<p style="padding-top: 8px; padding-bottom: 8px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px; margin: 0px; line-height: 26px; color: #595959;">与嵌入的原始页面间的通信
通过 window.postMessage</p>
<span style="float: right; color: RGBA(64, 184, 250, .5);">❞</span></blockquote>
<h3 data-tool="mdnice编辑器" style="padding: 0px; color: black; font-size: 17px; font-weight: bold; text-align: center; position: relative; margin-top: 20px; margin-bottom: 20px;"><span class="prefix" style="display: none;"></span><span class="content" style="border-bottom: 2px solid RGBA(79, 177, 249, .65); color: #2b2b2b; padding-bottom: 2px;"><span style="width: 30px; height: 30px; display: block; background-image: url(https://my-wechat.mdnice.com/fullstack-2.png); background-position: center; background-size: 30px; margin: auto; opacity: 1; background-repeat: no-repeat; margin-bottom: -8px;"></span>chrome 插件访问原始页面变量/函数等</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">因为谷歌的api是不让插件访问原始页面的变量的,但是很多插件都会有调用原始页面的方法或者获取js变量的需求,那么就要用类似破解的一些方法.就是在content.js执行过程中,插入script标签对到原始页面中,因为content.js虽然无法获取原始页面的函数,变量等,但是可以访问到dom,也就可以进行dom操作</p>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">如插入script标签对到原始页面中，并在里面插入自己的逻辑代码，以下称为inject-script.js</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// content.js</span>
<span/><span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span> <span class="hljs-title" style="color: #61aeee; line-height: 26px;">injectCustomJs</span>(<span class="hljs-params" style="line-height: 26px;">jsPath, callback</span>) </span>{
<span/>  jsPath = jsPath || <span class="hljs-string" style="color: #98c379; line-height: 26px;">'js/injectscript.js'</span>;
<span/>  <span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">var</span> script = <span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">document</span>.createElement(<span class="hljs-string" style="color: #98c379; line-height: 26px;">'script'</span>);
<span/>  script.setAttribute(<span class="hljs-string" style="color: #98c379; line-height: 26px;">'type'</span>, <span class="hljs-string" style="color: #98c379; line-height: 26px;">'text/javascript'</span>);
<span/>  <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 获得的地址类似：chrome-extension://ihcokhadfjfchaeagdoclpnjdiokfakg/js/inject.js</span>
<span/>  script.src = chrome.extension.getURL(jsPath);
<span/>  script.onload = <span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span> (<span class="hljs-params" style="line-height: 26px;"></span>) </span>{
<span/>    <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 放在页面不好看，执行完后移除掉</span>
<span/>    <span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">this</span>.parentNode.removeChild(<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">this</span>);
<span/>    setTimeout(<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span> (<span class="hljs-params" style="line-height: 26px;"></span>) </span>{
<span/>      callback()
<span/>    }, <span class="hljs-number" style="color: #d19a66; line-height: 26px;">3600</span>)
<span/>  };
<span/>  <span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">document</span>.head.appendChild(script);
<span/>}
<span/>
<span/><span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 在content.js初始化调用</span>
<span/><span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">document</span>.addEventListener(<span class="hljs-string" style="color: #98c379; line-height: 26px;">'DOMContentLoaded'</span>, <span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span> (<span class="hljs-params" style="line-height: 26px;"></span>) </span>{
<span/>    injectCustomJs(<span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">null</span>, <span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span> (<span class="hljs-params" style="line-height: 26px;"></span>) </span>{})
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">先说一下我尝试的一些方法,</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; font-size: 15px; color: #595959; list-style-type: circle;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;"><p style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">创建并插入 script 元素，执行其中 js 代码，可以传递消息或其他方式缓存书籍，然后删除元素.需注意，原始页面中的 js 变量可能不是立马生成，需要定时器延缓获取时机.这种方式只能传递某些类型如字符串，简单对象(会自动序列化)等，函数等无法传递，即使使用消息机制，函数也无法克隆</p>
</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;"><p style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">创建元素并设置 onclick 属性，然后在某一时机调用这个元素的onclick方法.实测在 chrome 插件中无效，元素无 onclick 方法,指向为null,即无法绑定内联事件</p>
</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;"><p style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">创建script元素，并通过addEventListener绑定原页面中的函数，在content-script中通过寻找该dom，并触发其事件(如果采用js原生，如注册click事件，是无法主动dispatch或trigger的，jquery提供了trigger主动触发事件).然而这样也有问题,这里存在着inject-script(本质上是向页面注入dom,也是原始页面)和content-script之间的通信问题，原始页面(包括inject-script)和content-script处在两个沙盒，彼此不共享变量，无法互相访问.虽然可以通过消息机制发送和接收,比如自定义的事件而不是onclick这些系统内置事件,结果仍然不行,无法传递js的变量,函数等，又回到最初的起点</p>
</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;"><p style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">终极大法：总而言之，无论是什么方式传递，只能传递字符串或者JSON字符串 在content-script中根据时机（如点击你注入的一个按钮）进行postMessage，inject-script中监听即可直接调用原始页面中函数或获取变量即可而无需传递</p>
<p style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">注入的样式被称为injected stylesheet，在chrome开发工具中无法修改</p>
</section></li></ul>
<h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; display: block; border-bottom: 4px solid #40B8FA;"><span class="prefix" style="display: flex; width: 20px; height: 20px; background-size: 20px 20px; background-image: url(https://my-wechat.mdnice.com/fullstack-1.png); margin-bottom: -22px;"></span><span class="content" style="display: flex; color: #40B8FA; font-size: 20px; margin-left: 25px;">chrome api</span><span class="suffix" style="display: flex; box-sizing: border-box; width: 200px; height: 10px; border-top-left-radius: 20px; background: RGBA(64, 184, 250, .5); color: rgb(255, 255, 255); font-size: 16px; letter-spacing: 0.544px; justify-content: flex-end; float: right; margin-top: -10px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></h2>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">扩展程序除了可以访问与网页相同的 API 外，还可以使用特定于扩展程序的 API，这些 API 可以与浏览器紧密集成。 扩展程序和网页都可以访问标准 window.open（）方法来打开 URL，但是扩展程序可以使用 Chrome API tabs.create 方法来指定显示 URL 的窗口。</p>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">大多数 Chrome API 方法都是异步的:它们会立即返回，而不需要等待操作完成。如果一个扩展需要知道异步操作的结果，它可以向该方法传递一个回调函数。回调在方法返回后执行，可能要晚得多。</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;">chrome: {
<span/>  tabs: {
<span/>    query: function({object queryInfo: {active: <span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">true</span>, currentWindow: <span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">true</span>}}, callback) {},
<span/>    update: function(tabs[<span class="hljs-number" style="color: #d19a66; line-height: 26px;">0</span>].id, {url: newUrl}) {},
<span/>    executeScript: function(tabs[<span class="hljs-number" style="color: #d19a66; line-height: 26px;">0</span>].id, {code}) {}
<span/>  },
<span/>  runtime: {
<span/>    <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 返回extensionDir</span>
<span/>    getURL: string function() {}，
<span/>    onInstalled: {
<span/>      addListener: function(calback) {}   <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 侦听运行时，用于设置状态或进行初始化</span>
<span/>    },
<span/>    getBackgroundPage: function() {},
<span/>    onMessage: {
<span/>      addListener: function(function(message, callback) {}) {}
<span/>    }
<span/>  },
<span/>  storage: {
<span/>    <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 存储的数据将自动同步到用户登录的任何Chrome浏览器。</span>
<span/>    sync: {
<span/>      get: function(key, callback || undefined) {},
<span/>      set: function(key, callback) {}
<span/>    }，
<span/>    local: {
<span/>      get: function(key, callback || undefined) {},
<span/>      set: function(key, callback) {}
<span/>    }
<span/>  }，
<span/>  <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 设置上下文菜单</span>
<span/>  contextMenus: {
<span/>    create: function({
<span/>      <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"id"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">""</span>,
<span/>      <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"title"</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">""</span>,
<span/>      <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">"contexts"</span>: [<span class="hljs-string" style="color: #98c379; line-height: 26px;">"selection"</span>]
<span/>    }) {}
<span/>  }
<span/>}
<span/></code></pre>
<h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; display: block; border-bottom: 4px solid #40B8FA;"><span class="prefix" style="display: flex; width: 20px; height: 20px; background-size: 20px 20px; background-image: url(https://my-wechat.mdnice.com/fullstack-1.png); margin-bottom: -22px;"></span><span class="content" style="display: flex; color: #40B8FA; font-size: 20px; margin-left: 25px;">chrome扩展页面间通信</span><span class="suffix" style="display: flex; box-sizing: border-box; width: 200px; height: 10px; border-top-left-radius: 20px; background: RGBA(64, 184, 250, .5); color: rgb(255, 255, 255); font-size: 16px; letter-spacing: 0.544px; justify-content: flex-end; float: right; margin-top: -10px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></h2>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">扩展中的不同组件常常需要彼此通信。不同的 HTML 页面可以通过 chrome 找到彼此。扩展方法，如 getViews()和 getBackgroundPage()。一旦一个页面引用了其他扩展页面，第一个页面就可以调用其他页面上的函数并操作它们的 dom。此外，扩展的所有组件都可以访问使用存储 API 存储的值，并通过 message passing.进行通信。</p>
<h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; display: block; border-bottom: 4px solid #40B8FA;"><span class="prefix" style="display: flex; width: 20px; height: 20px; background-size: 20px 20px; background-image: url(https://my-wechat.mdnice.com/fullstack-1.png); margin-bottom: -22px;"></span><span class="content" style="display: flex; color: #40B8FA; font-size: 20px; margin-left: 25px;">一些总结</span><span class="suffix" style="display: flex; box-sizing: border-box; width: 200px; height: 10px; border-top-left-radius: 20px; background: RGBA(64, 184, 250, .5); color: rgb(255, 255, 255); font-size: 16px; letter-spacing: 0.544px; justify-content: flex-end; float: right; margin-top: -10px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></h2>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">background 和 event pages 没有可见页面，区别在于，前者长时间挂载可能影响性能，在配置文件的区别上，后者仅多了一个<code style="font-size: 14px; word-wrap: break-word; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #3594F7; background: RGBA(59, 170, 250, .1); padding: 0 2px; border-radius: 2px; height: 21px; line-height: 22px;">persistent</code>参数，指定为 false;另外，event pages 特点是， 后台页面在需要时被加载，在空闲时被卸载。事件的一些例子包括</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; font-size: 15px; color: #595959; list-style-type: circle;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;">扩展首先被安装或更新到一个新版本。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;">后台页面正在监听事件，并且已调度该事件。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;">content script 或其他扩展发送消息</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;">扩展中的另一个视图，比如一个 popup，调用 runtime.getBackgroundPage。</section></li></ul>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">基于事件的后台脚本可以支持大多数扩展功能。只有在很少的情况下，扩展才应该有一个持久的后台</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器" style="display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; text-size-adjust: 100%; line-height: 1.55em; font-weight: 400; border-radius: 6px; color: #595959; font-style: normal; text-align: left; box-sizing: inherit; border-left: none; border: 1px solid RGBA(64, 184, 250, .4); background: RGBA(64, 184, 250, .1);"><span style="color: RGBA(64, 184, 250, .5); font-size: 34px; line-height: 1; font-weight: 700;">❝</span>
<p style="padding-top: 8px; padding-bottom: 8px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px; margin: 0px; line-height: 26px; color: #595959;">注： 官方的称呼是<code style="font-size: 14px; word-wrap: break-word; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #3594F7; background: RGBA(59, 170, 250, .1); padding: 0 2px; border-radius: 2px; height: 21px; line-height: 22px;">Event Driven Background Scripts</code>,即事件驱动脚本</p>
<span style="float: right; color: RGBA(64, 184, 250, .5);">❞</span></blockquote>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;"><strong style="color: #3594F7; font-weight: bold;"><span>「</span>侦听器必须从页面的开始并且同步注册<span>」</span></strong></p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// background.js</span>
<span/>chrome.runtime.onInstalled.addListener(<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span> (<span class="hljs-params" style="line-height: 26px;"></span>) </span>{
<span/>  chrome.contextMenus.create({
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">id</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"sampleContextMenu"</span>,
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">title</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">"Sample Context Menu"</span>,
<span/>    <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">contexts</span>: [<span class="hljs-string" style="color: #98c379; line-height: 26px;">"selection"</span>],
<span/>  });
<span/>});
<span/>
<span/><span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// This will run when a bookmark is created.</span>
<span/>chrome.bookmarks.onCreated.addListener(<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span> (<span class="hljs-params" style="line-height: 26px;"></span>) </span>{
<span/>  <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// do something</span>
<span/>});
<span/></code></pre>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">错误的实例</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;">chrome.runtime.onInstalled.addListener(<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span> (<span class="hljs-params" style="line-height: 26px;"></span>) </span>{
<span/>  <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// ERROR! Events must be registered synchronously from the start of</span>
<span/>  <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// the page.</span>
<span/>  chrome.bookmarks.onCreated.addListener(<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span> (<span class="hljs-params" style="line-height: 26px;"></span>) </span>{
<span/>    <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// do something</span>
<span/>  });
<span/>});
<span/></code></pre>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;"><strong style="color: #3594F7; font-weight: bold;"><span>「</span>扩展可以通过调用 removeListener 从后台脚本中删除侦听器。如果一个事件的所有监听器被移除，Chrome 将不再为该事件加载扩展的后台脚本。<span>」</span></strong></p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;">chrome.runtime.onMessage.addListener(<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span> (<span class="hljs-params" style="line-height: 26px;">message, sender, reply</span>) </span>{
<span/>  chrome.runtime.onMessage.removeListener(event);
<span/>});
<span/></code></pre>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;"><strong style="color: #3594F7; font-weight: bold;"><span>「</span>background 和 popup 无法直接访问页面 dom，但是可以通过 chrome.tabs.executeScript 执行脚本，如一开始的示例<code style="font-size: 14px; word-wrap: break-word; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #3594F7; background: RGBA(59, 170, 250, .1); padding: 0 2px; border-radius: 2px; height: 21px; line-height: 22px;">chrome.tabs.executeScript</code>，从而访问页面 dom，但也不能直接访问页面 js<span>」</span></strong></p>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;"><strong style="color: #3594F7; font-weight: bold;"><span>「</span>不支持将js写在内联html中，或者通过setAttribute形式<span>」</span></strong></p>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">更多内容可访问官方文档<a href="https://developer.chrome.com/extensions" style="text-decoration: none; word-wrap: break-word; color: #40B8FA; font-weight: normal; border-bottom: 1px solid #3BAAFA;">https://developer.chrome.com/extensions</a></p>
<p data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">因此我的插件伪代码应该是这样的</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// content.js</span>
<span/>
<span/><span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 1.注入dom，插入样式，注册事件等...</span>
<span/>
<span/><span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 2.向inject.script.js发送消息，表示在某个时机要在原页面执行某个操作</span>
<span/>$(<span class="hljs-string" style="color: #98c379; line-height: 26px;">'div'</span>).on(<span class="hljs-string" style="color: #98c379; line-height: 26px;">'click'</span>, <span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span> (<span class="hljs-params" style="line-height: 26px;">e</span>) </span>{
<span/>  <span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">window</span>.postMessage({ <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">type</span>: <span class="hljs-string" style="color: #98c379; line-height: 26px;">'to_inject'</span>, <span class="hljs-attr" style="color: #d19a66; line-height: 26px;">speed</span>: speed }, <span class="hljs-string" style="color: #98c379; line-height: 26px;">'*'</span>)
<span/>})
<span/>
<span/></code></pre>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/point.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; letter-spacing: 0px; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// inject-script.js</span>
<span/>setTimeout(<span class="hljs-function" style="line-height: 26px;"><span class="hljs-params" style="line-height: 26px;">()</span> =&gt;</span> {
<span/>  <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 插入到原始页面的script标签对之后，代码执行到这里来，页面上的dom结构未必加载完全，因此页面上的dom节点或者js变量都未生成，需要定时器</span>
<span/>  <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 可以获取dom和任意原始页面中可以获取到的js变量，调用函数等操作</span>
<span/>  <span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">window</span>.addEventListener(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"message"</span>, <span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span>(<span class="hljs-params" style="line-height: 26px;">e</span>) </span>{
<span/>    <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// inject-script（也就是原始页面）接收到消息</span>
<span/>    <span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">if</span>(e.data &amp;&amp; e.data.type === <span class="hljs-string" style="color: #98c379; line-height: 26px;">'to_inject'</span>) {
<span/>      <span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">// 执行原页面的某个函数调用</span>
<span/>    }
<span/>  }, <span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">false</span>);
<span/>}, <span class="hljs-number" style="color: #d19a66; line-height: 26px;">3000</span>)
<span/></code></pre>
<h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px; display: block; border-bottom: 4px solid #40B8FA;"><span class="prefix" style="display: flex; width: 20px; height: 20px; background-size: 20px 20px; background-image: url(https://my-wechat.mdnice.com/fullstack-1.png); margin-bottom: -22px;"></span><span class="content" style="display: flex; color: #40B8FA; font-size: 20px; margin-left: 25px;">chrome扩展打包/发布/使用</span><span class="suffix" style="display: flex; box-sizing: border-box; width: 200px; height: 10px; border-top-left-radius: 20px; background: RGBA(64, 184, 250, .5); color: rgb(255, 255, 255); font-size: 16px; letter-spacing: 0.544px; justify-content: flex-end; float: right; margin-top: -10px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></h2>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; font-size: 15px; color: #595959; list-style-type: circle;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;"><p style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">打包可以通过chrome扩展管理界面打包和加载，打包扩展程序会将项目文件夹打包为crx后缀文件
以前的chrome浏览器在打开开发者模式下，直接拖入crx即可安装扩展，现在没有上架chrome扩展商店的应用无法安装</p>
</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;"><p style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">至于发布，需要有visa等信用卡付款才能上架应用，还是比较难搞的</p>
</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;"><p style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">使用，插件源码<a href="https://github.com/lovelyJason/baidu_player_speed.git" style="text-decoration: none; word-wrap: break-word; color: #40B8FA; font-weight: normal; border-bottom: 1px solid #3BAAFA;">https://github.com/lovelyJason/baidu_player_speed.git</a> 在chrome扩展管理界面导入文件夹，然后勾选插件的启用，在播放网盘视频的界面就可以看到效果啦</p>
</section></li></ul>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68f1f8929eec49dda3f5e4618eac979d~tplv-k3u1fbpfcp-watermark.image" alt style="max-width: 100%; border-radius: 6px; display: block; margin: 20px auto; object-fit: contain; box-shadow: 2px 4px 7px #999;"></figure>
<p id="nice-suffix-juejin-container" class="nice-suffix-juejin-container" data-tool="mdnice编辑器" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px; margin-top: 20px !important;"></p></section>
